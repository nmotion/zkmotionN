'Dim Parg As Double'Dim Qarg As Double'Dim Rarg As Double'P 螺距Parg=Param1()'Q 螺纹深度   z轴留5mm安全高度  Qarg=param2()'R  螺纹长度Rarg=param3()Message "P=" & Parg & "Q=" & Qarg & "R=" & Rarg If Parg=0 Or Qarg=0 Or Rarg=0 Then  Message "P Q R  can't be zero!"  Exit SubEnd IfDim APos as DoubleZPos  = GetOemDro(802)XPos  = GetOemDro(800)APos  = GetOemDro(803)FSpeed = GetOemDro(818)RoutA=Abs(Rarg/Parg)RreRoutA=1*360AMoverout=RoutA*360Dim RotSpeed as integer RotSpeed=80*360'DigRate=FSpeed*360DigDeep=0DigTime=0ZSafe=ZPos+5Do  'pre move A and Z axisAPos  = GetOemDro(803)DigTime=DigTime+1DigDeep=0.5*DigTimeif DigDeep>Qarg then  DigDeep=Qargend ifZAim=ZPos-DigDeepAMovAim=APos+RreRoutAAEndAim=AMovAim+AMoveroutAStopAim=AEndAim+RreRoutAXEndAim=XPos-RargCode("G1Z" & ZAim & "A" &AMovAim & "F" & RotSpeed)Code("G1A" & AEndAim & "X" & XEndAim & "F" & RotSpeed  )'Z off,A stop'Code("G0Z" & ZSafe)Code("G1Z" & ZPos & "A" & AStopAim & "F" & RotSpeed)Code("G1Z" & ZSafe )Code("G0X" & XPos )'move back to start  While IsMoving()  Wend  Code("G4P1")Code("G0X" & XPos &"Z" & ZPos ) Loop Until  Abs(DigDeep) >= Abs(Qarg )   Code("G0X" & XPos &"Z" & ZPos )     